stages:
  - deploy_backend
  - deploy_frontend
  - deploy_bot
  - deploy_all

deploy_backend_job:
  stage: deploy_backend
  tags:
    - deploy
  only:
    - backend
  script:
    - cp ${ENV_BACKEND} backend.env
    - docker compose -f docker-compose-ci.yml up -d --build --scale frontend=0 --scale notifications=0

deploy_frontend_job:
  stage: deploy_frontend
  tags:
    - deploy
  only:
    - frontend
  script:
    - cp ${ENV_FRONTEND} frontend.env
    - docker compose -f ./frontend/docker-compose-ci.yml up -d --build --scale backend=0 --scale notifications=0

deploy_bot_job:
  stage: deploy_bot
  tags:
    - deploy
  only:
    - bot
  script:
    - cp ${ENV_BOT} bot.env
    - docker compose -f ./notifications/docker-compose-ci.yml up -d --build --scale backend=0 --scale frontend=0

deploy_all_job:
  stage: deploy_all
  tags:
    - deploy
  only:
    - main
  script:
    - cp ${ENV_BACKEND} backend.env
    - cp ${ENV_FRONTEND} frontend.env
    - cp ${ENV_BOT} bot.env
    - docker compose -f docker-compose-ci.yml up -d --build
