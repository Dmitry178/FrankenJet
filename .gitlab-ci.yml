stages:
  - deploy_backend
  - deploy_frontend

deploy_backend_job:
  stage: deploy_backend
  tags:
    - deploy
  only:
    - backend
  variables:
    IMAGE: fj-backend
  script:
    - cp ${ENV_BACKEND} backend.env
    - docker compose -f docker-compose-p.yml up -d --build --scale frontend=0
  after_script:
    - rm -f ./backend.env


deploy_frontend_job:
  stage: deploy_frontend
  tags:
    - deploy
  only:
    - frontend
  script:
    - cp ${ENV_FRONTEND} frontend.env
    - docker compose -f ./frontend/docker-compose-p.yml up -d --build --scale backend=0
  after_script:
    - rm -f ./frontend.env
