stages:
  - deploy_backend
  - deploy_frontend

deploy_backend_job:
  stage: deploy_backend
  tags:
    - deploy
  rules:
    - if: $CI_COMMIT_BRANCH == "deploy"
      changes:
        - backend/**/*
        - .gitlab-ci.yml
        - docker-compose.back.yml
  variables:
    IMAGE: fj-backend
  script:
    - cp ${ENV_BACKEND} backend.env
    - docker compose -f docker-compose.back.yml up -d --build
  after_script:
    - rm -f ./backend.env

deploy_frontend_job:
  stage: deploy_frontend
  tags:
    - deploy
  rules:
    - if: $CI_COMMIT_BRANCH == "deploy"
      changes:
        - frontend/**/*
        - .gitlab-ci.yml
        - docker-compose.front.yml
  script:
    - cp ${ENV_FRONTEND} frontend.env
    - docker compose -f ./frontend/docker-compose.front.yml up -d --build
  after_script:
    - rm -f ./frontend.env
