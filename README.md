# FrankenJet. Энциклопедия истории авиации

[https://frankenjet.ru]()

## О проекте

**FrankenJet** - это проект, целью которого является предоставить пользователям удобный и информативный ресурс об истории авиации. Это путешествие по захватывающему миру воздушных судов, конструкторов и событий, сформировавших воздушную историю человечества.

![](home.png)
*Главная страница*

![](search.png)
*Страница поиска*

![](article.png)
*Страница статьи*

![](article-dark.png)
*Страница статьи, тёмная тема*

---

### Технологии

Fullstack: FastAPI (backend) + Vue.js 3.5 (frontend) + Aiogram (микросервис).

* **Backend:**
  * Python 3.12, PostgreSQL 17 (AsyncPG, SQLAlchemy 2 ORM), API (async FastAPI, WebSocket, AIOHTTP), S3 MiniO (AIOBoto3), RabbitMQ (FastStream), Redis (FastApi-Cache2), Elasticsearch.
* **Frontend:**
  * Vue.js 3.5, Vite, Vuetify, Axios, Pinia, Vue Router.
* **Microservice (бот уведомлений):**
  * Python 3.12, AIOGram3, FastStream.
* **Запуск и управление сервисами:**
  * Docker, Docker compose.
* **Линтеры:**
  * Ruff, MyPy.

---

### Архитектура проекта

![](fja.png)

---

### Общая структура проекта

```
📦 franken-jet
├─ 🗂️ backend                  # Основной backend (FastAPI)
│  ├─ 📁 alembic               # Миграции
│  ├─ 📁 app                   # Основной исходный код бэкенда
│  │  ├─ 📁 api                # Маршруты FastAPI
│  │  ├─ 📁 config             # Конфигурация приложения
│  │  ├─ 📁 consumers          # Consumer брокера сообщений RabbitMQ
│  │  ├─ 📁 core               # Основные модули, контекстные мереджеры
│  │  ├─ 📁 db                 # Модели и репозитории базы данных
│  │  ├─ 📁 decorators         # Декораторы для обработки ошибок и других утилит
│  │  ├─ 📁 dependencies       # Компоненты Dependency Injections
│  │  ├─ 📁 exceptions         # Исключения
│  │  ├─ 📁 schemas            # Pydantic-схемы
│  │  └─ 📁 services           # Сервисный слой (бизнес-логика)
│  ├─ 📁 scripts               # Скрипты инициализации приложения при запуске через docker-compose
│  ├─ 📁 tests                 # Тесты (integration, unit)
│  ├─ 📄 alembic.ini           # Настройки alembic
│  ├─ 📄 docker-compose.yml    # Деплой бэкенда в production
│  ├─ 📄 Dockerfile            # Определение контейнера бэкенда
│  ├─ 📄 example.env           # Пример файла переменных окружения бэкенда
│  ├─ 📄 main.py               # Точка входа в приложение (backend)
│  ├─ 📄 mypy.ini              # Настройки статической проверки типов
│  ├─ 📄 pyproject.toml        # Конфигурация проекта (зависимости, настройки инструментов и т.д.)
│  ├─ 📄 pytest.ini            # Настройки тестирования
│  ├─ 📄 README.md             # Документация бэкенда
│  └─ 📄 uv.lock               # Файл блокировки версий зависимостей
│
├─ 🗂️ frontend                 # Web-приложение (Vue.js)
│  ├─ 📁 public                # Публичные файлы, доступные напрямую
│  ├─ 📁 src                   # Основной исходный код фронтенда
│  │  ├─ 📁 assets             # Статические ресурсы проекта
│  │  ├─ 📁 components         # Переиспользуемые компоненты Vue
│  │  ├─ 📁 plugins            # Плагины Vue, маршруты, настройки Axios
│  │  ├─ 📁 public             # Публичные ресурсы
│  │  ├─ 📁 stores             # Хранилища состояний (Pinia), логика аутентификации
│  │  ├─ 📄 App.vue            # Корневой компонент приложения
│  │  ├─ 📄 main.js            # Точка входа в приложение (frontend)
│  │  └─ 📄 vuetify.config.js  # Конфигурация Vuetify
│  ├─ 📄 docker-compose.yml    # Деплой фронтенда в production
│  ├─ 📄 Dockerfile            # Определение контейнера фронтенда
│  ├─ 📄 example.env           # Пример файла переменных окружения фронтенда
│  ├─ 📄 index.html            # Главная HTML-страница
│  ├─ 📄 nginx.conf            # Конфигурационный файл Nginx для фронтенда
│  ├─ 📄 package.json          # Зависимости, скрипты и метаданные проекта
│  ├─ 📄 package-lock.json     # Файл блокировки версий зависимостей
│  ├─ 📄 README.md             # Документация фронтенда
│  └─ 📄 vite.config.js        # Конфигурационный файл для Vite (сборщика проекта)
│
├─ 🗂️ notifications            # Телеграм-бот уведомлений (Aiogram)
│  ├─ 📁 app                   # Основной исходный код бота
│  │  ├─ 📁 bot                # События, обработчики, клавиатуры бота
│  │  ├─ 📁 broker             # Обработчики сообщений из RabbitMQ
│  │  └─ 📁 core               # Основные модули: логи, конфигурация
│  ├─ 📄 bot.env               # Файл переменных окружения для запуска бота через docker-compose-bot.yml
│  ├─ 📄 Dockerfile            # Определение контейнера бота
│  ├─ 📄 example.env           # Пример файла переменных окружения бота уведомлений
│  ├─ 📄 main.py               # Точка входа в приложение бота
│  └─ 📄 README.md             # Документация бота
│
├─ 🗂️ volumes                  # Директория для томов при запуске приложения через docker compose
│
├─ 📄 .gitlab-ci.yml           # Пайплайны для деплоя в production (только backend и frontend, остальные сервисы деплоятся отдельно)
├─ 📄 docker-compose.yml       # Локальный запуск лёгкой версии приложения (Redis, RabbitMQ и без бота уведомлений)
├─ 📄 docker-compose-bot.yml   # Локальный запуск приложения с Redis, RabbitMQ и ботом уведомлений
└─ 📄 README.md                # Общая документация
```

---

## Состояние проекта

* **Backend:**
  * Использованы архитектурные паттерны: API → Service → Repository для изоляции слоёв и масштабируемости приложения.
  * Аутентификация с использованием access и refresh JWT (через email/пароль и Google).
  * Авторизация пользователей исходя из их ролей.
  * Модели базы данных для хранения информации о пользователях, токенах, статьях, воздушных судах, конструкторских бюро, конструкторах и производителях.
  * API для получения данных по каждой категории.
  * Настроены миграции через Alembic для разных режимов работы приложения (локальной разработки и production).
  * Контекстные менеджеры для базы данных, HTTP, RabbitMQ, S3 и Elasticsearch, менеджеры для Redis и WebSocket.
  * Кэширование настроек приложения и статьей.
  * Скрипты для:
    * создания и инициализации базы данных;
    * добавления первичных данных и статей;
    * настройки бакетов и загрузки изображений в S3.
  * Поиск по статьям, фактам и прочим сущностям базы данных через Elasticsearch (или через SQL-запросы при недоступности Elasticsearch).
  * Декораторы для унифицированной обработки ошибок базы данных в сервисном слое.

* **Frontend:**
  * Автоматический запрос на перевыпуск пары access/refresh-токенов.
  * Базовая структура приложения:
    * главная страница с 3 случайными статьями и 5 интересными фактами;
    * страница статей с техническими характеристиками и содержанием.
    * страница результатов поиска по статьям и фактам.
  * Поддержка тем (включая тёмную).
  * Адаптивный дизайн (десктоп, планшет, телефон).
  * SEO-метаданные.

* **Микросервисы:**
  * Бот уведомлений (выводит события в бэкенде, получает события об аутентификации администратора и новых комментариях), работает через RabbitMQ.

* **Безопасность:**
  * Защита от CSRF-атак. Реализована в backend через middleware (генерация и проверка токенов, передаваемых в заголовках из frontend). Отключено для локальной разработки, есть возможность отключить в production для Swagger UI и ReDoc.
  * Защита от XSS-атак. Обеспечивается экранированием данных и санитизацией пользовательского ввода на frontend, и строгой валидацией данных в backend.

* **Контейнеризация и CI/CD:**
  * Настроен автоматизированный процесс сборки и деплоя с использованием GitLab CI/CD.
  * Пайплайны для деплоя бэкенда, фронтенда, бота уведомлений и всего приложения в целом при мерже в соответствующие ветки.
  * Созданы различные варианты контейнеризации и запуска приложения через docker-compose (минимальный вариант без Redis, RabbitMQ, Elasticsearch и бота, и полный вариант).

### Планируется (roadmap)

* **Backend:**
  * Сделать индексацию статей для Elasticsearch.
  * Теги.
  * Rate limiter.
  * Модели/API персоналий и исторических событий.
  * Задачи (Celery).
  * Тесты.
  * Мониторинг.

* **Функциональность:**
  * Профиль пользователя.
  * Глобальный поиск.
  * Фотогалерея.
  * Аутентификация через VK, Yandex, Telegram.
  * Система исправления неточностей.
  * Комментарии и оценки.
  * Встроенный редактор статей.

* **Энциклопедия:**
  * Карточки: статей, воздушных судов, бюро, конструкторов, персоналий, событий.

* **Микросервисы:**
  * **AI-модератор.** Автоматическая модерация пользовательских комментариев с использованием LLM. На первом этапе — интеграция готовых языковых моделей, в дальнейшем — разработка и обучение собственной модели на PyTorch для повышения точности и адаптации к тематике проекта.
  * **AI-редактор.** Интеллектуальный помощник для работы со статьями: улучшение, дополнение, структурирование, суммаризация, оптимизация под SEO, генерация технических характеристик и пр. Использует LLM в качестве агента, адаптированного под тематику проекта.

* **Безопасность:**
  * Автоматическое завершение подозрительных сессий.

---

## Запуск проекта локально

Убедитесь, что у вас установлены **Docker** и **Docker Compose**.

### Клонируйте репозиторий

```bash
git clone https://github.com/Dmitry178/FrankenJet.git
cd FrankenJet
```

### Запуск приложения

#### Лайт-версия (без Redis, RabbitMQ и бота уведомлений)

Запустите:
```bash
docker-compose up -d --build
```

#### Версия с Redis, RabbitMQ и ботом уведомлений

1. Откройте `/notifications/bot.env`.
2. Укажите свои значения:
   * **TELEGRAM_ADMIN_ID** — ваш `Telegram ID` (можно получить у @userinfobot),
   * **TELEGRAM_API_TOKEN** — `токен бота` (можно получить у @BotFather).
3. Сохраните файл.
4. Запустите:
   ```bash
   docker-compose -f docker-compose-bot.yml up -d --build
   ```

### Открыть приложение

Откройте приложение в браузере: http://localhost:3100

### Остановка приложения

#### лайт-версия

```bash
docker-compose down
```

#### полная версия
```bash
docker-compose -f docker-compose-bot.yml down
```

### Данные по умолчанию

**Внимание!** Используются **нестандартные** порты, чтобы избежать возможных конфликтов с установленными локально сервисами. Перед запуском убедитесь, что используемые приложением порты, указанные в docker-compose.yml, свободны. 

| Сервис      | Порт (API) | Порт (UI/Console) | Логин   | Пароль   | URL                                                      |
|-------------|------------|-------------------|---------|----------|----------------------------------------------------------|
| PostgreSQL  | 5436       | —                 | fj_user | fj_pass  | —                                                        |
| Redis       | 6380       | —                 | —       | password | —                                                        |
| MiniO       | 9910       | 9911              | admin   | password | [http://localhost:9910](http://localhost:9910)           |
| RabbitMQ    | 5676       | 15676             | admin   | password | [http://localhost:15676](http://localhost:15676)         |
| Frontend    | 3100       | —                 | admin   | password | [http://localhost:3100](http://localhost:3100)           |
| Backend     | 8100       | —                 | admin   | password | [http://localhost:8100/docs](http://localhost:8100/docs) |
| Bot         | —          | —                 | —       | —        | —                                                        |

---

## Организация CI/CD

Для автоматизации сборки и деплоя используется **GitLab CI/CD**. Пайплайны описаны в файле `.gitlab-ci.yml`.

### Требования к инфраструктуре

Перед запуском CI/CD убедитесь, что следующие сервисы развёрнуты и доступны:

- PostgreSQL.
- RabbitMQ.
- Redis.
- MinIO (или совместимое хранилище).

### Настройка GitLab Runner

1. Убедитесь, что у вас есть GitLab Runner с тегом `deploy`.
2. Если у вас нет подходящего раннера, [настройте его](https://docs.gitlab.com/runner/install/) и добавьте тег `deploy`.

### Настройка переменных окружения

1. Перейдите в настройки репозитория: `Settings → CI/CD → Variables`.
2. Убедитесь, что в `Minimum role to use pipeline variables` установлена нужная роль (например, `Developer`, `Maintainer` или `Owner`).
3. Добавьте следующие переменные окружения:

#### ENV_BACKEND

- **Type:** `File`
- **Visibility:** `Visible`
- **Flags:** `Expand variable reference` (убрать `Protect variable`, если есть)
- **Key:** `ENV_BACKEND`
- **Value:** содержимое файла `example.env` из проекта бэкенда с вашими значениями

#### ENV_FRONTEND

- **Type:** `File`
- **Visibility:** `Visible`
- **Flags:** `Expand variable reference`
- **Key:** `ENV_FRONTEND`
- **Value:** содержимое файла `example.env` из проекта фронтенда с вашими значениями

#### ENV_BOT

- **Type:** `File`
- **Visibility:** `Visible`
- **Flags:** `Expand variable reference`
- **Key:** `ENV_BOT`
- **Value:** содержимое файла `example.env` из проекта бота с вашими значениями

### Запуск деплоя

Деплой запускается при **Merge Request** в следующие ветки:

- `backend` — деплой бэкенда,
- `frontend` — деплой фронтенда,
- `bot` — деплой бота уведомлений,
- `main` — деплой всех сервисов.

После Merge дождитесь завершения пайплайна в разделе **CI/CD → Pipelines**.

---

## Автор

Дмитрий Одегов ([Dmitry178](https://t.me/dmitry178))
